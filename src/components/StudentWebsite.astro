---
import StudentWorkCarousel from "./StudentWorkCarousel.astro";

const {
  name,
  url,
  presentation,
  image,
  capturedAt,
  error,
  note,
  previewType,
  progress,
  work,
  ...attrs
} = Astro.props ?? {};

let hostname = url;
try {
  hostname = new URL(url).hostname;
} catch {
  hostname = url;
}

const formattedCapturedAt = capturedAt
  ? new Date(capturedAt).toLocaleString(undefined, {
      dateStyle: "medium",
      timeStyle: "short",
    })
  : null;

// Generate unique ID for carousel
const carouselId = `student-carousel-${Math.random().toString(36).substr(2, 9)}`;
const workImages = work?.images ?? [];
---

<article
  class="student-article"
  data-preview-type={previewType ?? undefined}
  {...attrs}
>
  {
    progress?.researchQuestion && (
      <div class="research-question">
        <h3>Q: {progress.researchQuestion}</h3>
        <div class="flex gap-4 mt-4 flex-wrap">
          <a
            class="student-card__link inline-block"
            href={url}
            target="_blank"
            rel="noopener noreferrer"
          >
            {name}
          </a>
          {presentation && (
            <a
              class="student-card__link inline-block"
              href={presentation}
              target="_blank"
              rel="noopener noreferrer"
            >
              [ Presentation ]
            </a>
          )}
        </div>
      </div>
    )
  }

  {
    progress && (
      <div class="student-progress mt-4 space-y-3 text-sm">
        {progress.form && (
          <div>
            <strong class="block text-xs uppercase tracking-wide opacity-60 mb-2">
              Current Form
            </strong>
            <p class="leading-relaxed">{progress.form}</p>
          </div>
        )}
      </div>
    )
  }

  <!-- <div class="student-card__preview">
    {
      image ? (
        <img
          src={image}
          alt={`${name}'s project preview`}
          loading="lazy"
          decoding="async"
          class="aspect-video object-cover mt-4"
        />
      ) : (
        <div
          class="student-card__placeholder"
          role="img"
          aria-label={`Placeholder preview for ${name}`}
        />
      )
    }
  </div> -->

  <StudentWorkCarousel studentName={name} />
</article>
